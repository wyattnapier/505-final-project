# -*- coding: utf-8 -*-
"""CS505_Final_Dataset_Aggregation.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1Fl8qUaZYbAv6LfSmm0uyIh3X675eCeix
"""

import json
import os

INPUT_FILE  = "/content/merged_emotions.jsonl"
OUTPUT_FILE = "merged_emotions_final.jsonl"

def load_records(path):
    """Yield each JSON object from a JSONL file."""
    with open(path, 'r', encoding='utf-8') as f:
        for line in f:
            line = line.strip()
            if not line:
                continue
            yield json.loads(line)

def process_record(obj):
    """Fill empty emotions_1 with emotions_2, drop emotions_2, and rename."""
    e1 = obj.get("emotions_1") or []
    e2 = obj.get("emotions_2") or []
    # if e1 is empty, use e2
    if not e1 and e2:
        obj["emotions_1"] = e2
    # drop emotions_2
    if "emotions_2" in obj:
        del obj["emotions_2"]
    # rename emotions_1 â†’ emotions
    obj["emotions"] = obj.pop("emotions_1", [])
    return obj

def main():
    if not os.path.exists(INPUT_FILE):
        raise FileNotFoundError(f"Cannot find {INPUT_FILE}")

    with open(OUTPUT_FILE, 'w', encoding='utf-8') as fout:
        for record in load_records(INPUT_FILE):
            new_rec = process_record(record)
            fout.write(json.dumps(new_rec, ensure_ascii=False) + "\n")

    print(f"Done! Written {OUTPUT_FILE}")

if __name__ == "__main__":
    main()